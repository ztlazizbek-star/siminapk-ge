# Инструкция по установке обновленного SMS API

## Проблема
Серверный файл `sms.php` на tajstore.ru работает в режиме разработки (`$DEV_MODE = true`), поэтому SMS не отправляются реально.

## Решение

### Шаг 1: Скачайте файл
Скачайте файл `sms-final.php` из этого проекта.

### Шаг 2: Настройте параметры
Откройте файл `sms-final.php` и измените следующие строки:

\`\`\`php
// Установите false для продакшена
$DEV_MODE = false;

// Вставьте ваши реальные данные OsonSMS
$login = 'YOUR_LOGIN';  // Замените на ваш логин
$secret = 'YOUR_SECRET_KEY';  // Замените на ваш секретный ключ
\`\`\`

### Шаг 3: Загрузите на сервер
1. Подключитесь к серверу tajstore.ru через FTP (FileZilla, WinSCP) или SSH
2. Найдите папку `simin/`
3. Переименуйте старый файл `sms.php` в `sms.php.backup` (для резервной копии)
4. Загрузите файл `sms-final.php` и переименуйте его в `sms.php`

### Шаг 4: Проверьте права доступа
Убедитесь, что файл имеет права на выполнение (обычно 644 или 755):
\`\`\`bash
chmod 644 simin/sms.php
\`\`\`

### Шаг 5: Протестируйте
После установки попробуйте:
1. Войти в приложение (должен прийти код подтверждения с префиксом)
2. Оформить заказ (должно прийти уведомление без префикса)

## Как работает новый файл

### Два типа SMS:

1. **Код подтверждения** (при регистрации/входе):
   - Отправляется: `{"phone": "200406003", "code": "1234", "type": "verification"}`
   - Клиент получает: "Ваш код подтверждения: 1234"

2. **Уведомление о заказе**:
   - Отправляется: `{"phone": "200406003", "code": "Ваш заказ успешно оформлен! Общая сумма: 6.00 TJS", "type": "notification"}`
   - Клиент получает: "Ваш заказ успешно оформлен! Общая сумма: 6.00 TJS" (БЕЗ префикса)

### Особенности:
- ✅ Автоматически удаляет код страны 992 из номера
- ✅ Валидирует номер (должен быть ровно 9 цифр)
- ✅ Логирует все запросы и ответы для отладки
- ✅ Поддерживает два типа сообщений
- ✅ Режим разработки для тестирования ($DEV_MODE = true/false)

## Важно!
Файл `public/sms.php` в Next.js проекте НЕ работает, потому что Next.js не выполняет PHP файлы. Файл ОБЯЗАТЕЛЬНО должен быть загружен на сервер tajstore.ru.
\`\`\`

```typescript file="" isHidden
